version: "3.6"

services:
 mapserver_frontend:
  image: node:21.5.0-alpine
  volumes:
   - "dev_home:/root"
   - ".:/data"
  working_dir: /data/public
  command: ["npm", "ci"]
 
 mapserver:
  image: golang:1.21.5
  depends_on:
   - minetest
   - mapserver_frontend
  volumes:
   - "dev_home:/root"
   - "world_data:/data/world"
   - ".:/data"
   - "./public:/data/world/public"
   - "./dev/mapserver.json:/data/world/mapserver.json"
  ports:
   - "8080:8080"
  working_dir: /data/world
  command: ["go", "run", ".."]

volumes:
  world_data: {}
  dev_home: {}